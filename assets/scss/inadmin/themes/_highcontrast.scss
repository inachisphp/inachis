@use '../definitions' as *;
@use 'sass:color';

@mixin high-contrast-theme {
/* Primitives - Neutrals (Extreme Contrast) */
    --color-neutral-000: #000000; /* Pure Black Background */
    --color-neutral-050: #000000;
    --color-neutral-100: #000000;
    --color-neutral-200: #1a1a1a; /* Very dark surface for distinction */
    --color-neutral-250: #ffffff; /* Borders must be white/bright */
    --color-neutral-300: #ffffff;
    --color-neutral-400: #ffffff;
    --color-neutral-500: #ffffff;
    --color-neutral-600: #ffffff;
    --color-neutral-700: #ffffff; /* All text becomes white */
    --color-neutral-800: #ffffff;
    --color-neutral-900: #ffffff;

    /* Primitives - Brand (High Luminance) */
    --color-brand-400: #00ffff; /* Cyan (High contrast on black) */
    --color-brand-500: #ffff00; /* Pure Yellow (Extreme visibility) */
    --color-brand-600: #ffff00;

    --color-accent-500: #ffffff;

    /* Semantic - Neon Tones for AAA */
    --color-success-500: #00ff00; /* Pure Green */
    --color-danger-500: #ff5555;  /* Bright Red */
    --color-warning-500: #ffff00; /* Pure Yellow */
    --color-info-500: #00ffff;

    /* Custom HC Variables */
    --hc-focus-outline: 3px solid #ffff00;

  .EasyMDEContainer {
    /* AAA Requirement: Text must be high contrast */
    .CodeMirror {
      background: var(--color-neutral-000) !important;
      color: #ffffff !important;
      border: 2px solid #ffffff !important; /* Thicker borders */
    }

    /* AAA Requirement: Focus must be unmistakable */
    .CodeMirror-focused {
      outline: var(--hc-focus-outline) !important;
      outline-offset: 2px;
    }

    /* AAA Requirement: Selection needs strong contrast */
    .CodeMirror-selected {
      background: #ffffff !important;
      color: #000000 !important; /* Invert text in selection */
    }

    /* -----------------------------------------
     Syntax - Using High Luminance Colors
    --------------------------------------------- */
    .cm-header { color: var(--color-brand-500) !important; font-weight: 900; }
    .cm-strong { color: #ffffff !important; text-decoration: underline; }
    .cm-em { color: #ffffff !important; font-style: italic; border-bottom: 1px dashed; }
    .cm-link { color: var(--color-brand-400) !important; text-decoration: underline; }

    /* Fixed your syntax error from the original file */
    .cm-variable-2 { color: var(--color-warning-500) !important; }
    .cm-tag { color: var(--color-brand-400) !important; }

    /* -----------------------------------------
     Toolbar - AAA (No subtle hovers)
    --------------------------------------------- */
    .editor-toolbar {
      background: #000000 !important;
      border: 2px solid #ffffff !important;

      button {
        color: #ffffff !important;
        opacity: 1 !important;
        border: 1px solid transparent;

        &:hover {
          background: #ffffff !important;
          color: #000000 !important;
          border-color: #ffffff !important;
        }

        &.active {
          background: var(--color-brand-500) !important;
          color: #000000 !important;
          outline: 2px solid #ffffff;
        }
      }
    }
  }

  .EasyMDEContainer {
    background: var(--color-neutral-000) !important;
    border: 3px solid var(--color-neutral-300) !important;
    opacity: 1 !important;
    filter: none !important;
  }

  /* Inactive must still be fully readable */
  .EasyMDEContainer.is-inactive {
    opacity: 1 !important;
    filter: none !important;
  }

  /* ---------------- Editor ---------------- */

  .CodeMirror {
    background: var(--color-neutral-000) !important;
    color: var(--color-neutral-900) !important;
    border: 2px solid var(--color-neutral-300) !important;
    box-shadow: none !important;
  }

  /* Kill all glow / blur / animation */
  .CodeMirror-focused {
    outline: var(--hc-focus-outline) !important;
    outline-offset: 3px;
    box-shadow: none !important;
    backdrop-filter: none !important;
  }

  /* ---------------- Cursor ---------------- */

  .CodeMirror-cursor {
    border-left: 3px solid var(--color-brand-500) !important;
    animation: none !important;
  }

  /* ---------------- Active Line ---------------- */

  .CodeMirror-activeline-background {
    background: var(--color-neutral-200) !important;
    box-shadow: none !important;
  }

  /* ---------------- Gutter ---------------- */

  .CodeMirror-gutters {
    background: var(--color-neutral-000) !important;
    border-right: 3px solid var(--color-neutral-300) !important;
  }

  .CodeMirror-linenumber {
    color: var(--color-neutral-900) !important;
    opacity: 1 !important;
  }

  .CodeMirror-activeline-gutter .CodeMirror-linenumber {
    background: var(--color-brand-500) !important;
    color: #000000 !important;
    font-weight: 900;
    border-radius: 0;
  }

  /* ---------------- Selection ---------------- */

  .CodeMirror-selected {
    background: #ffffff !important;
    color: #000000 !important;
    box-shadow: none !important;
  }

  /* Selection on active line */
  .CodeMirror-activeline .CodeMirror-selected {
    background: #ffff00 !important;
    color: #000000 !important;
  }

  /* ---------------- Markdown Syntax ---------------- */

  .cm-header {
    color: var(--color-brand-500) !important;
    font-weight: 900 !important;
    text-decoration: underline;
  }

  .cm-strong {
    color: #ffffff !important;
    font-weight: 900 !important;
    text-decoration: underline;
  }

  .cm-em {
    color: #ffffff !important;
    font-style: italic;
    border-bottom: 2px dashed #ffffff;
  }

  .cm-link,
  .cm-url {
    color: var(--color-brand-400) !important;
    text-decoration: underline !important;
    font-weight: 700;
  }

  .cm-code,
  .cm-inline-code {
    background: var(--color-neutral-200) !important;
    color: #ffffff !important;
    border: 1px solid #ffffff;
  }

  .cm-comment {
    color: #ffffff !important;
    opacity: 1 !important;
  }

  /* ---------------- Toolbar ---------------- */

  .editor-toolbar {
    background: var(--color-neutral-000) !important;
    border-bottom: 3px solid var(--color-neutral-300) !important;
    box-shadow: none !important;

    a,
    button {
      color: #ffffff !important;
      opacity: 1 !important;
      border: 2px solid transparent;
      transition: none !important;

      &:hover,
      &:focus-visible {
        background: #ffffff !important;
        color: #000000 !important;
        border-color: #ffffff !important;
      }

      &.active {
        background: var(--color-brand-500) !important;
        color: #000000 !important;
        border-color: #ffffff !important;
      }
    }
  }

  /* ---------------- Status Bar ---------------- */

  .editor-statusbar {
    color: #ffffff !important;
    border-top: 3px solid var(--color-neutral-300) !important;
  }

  /* ---------------- Preview Pane ---------------- */

  .editor-preview,
  .editor-preview-side {
    background: var(--color-neutral-000) !important;
    color: #ffffff !important;
    border-left: 3px solid var(--color-neutral-300) !important;

    ::selection {
      background: #ffffff !important;
      color: #000000 !important;
    }

    h1, h2, h3, h4, h5, h6 {
      color: var(--color-brand-500) !important;
      text-decoration: underline;
    }

    a {
      color: var(--color-brand-400) !important;
      text-decoration: underline !important;
      font-weight: 700;
    }

    code,
    pre {
      background: var(--color-neutral-200) !important;
      color: #ffffff !important;
      border: 2px solid #ffffff;
    }
  }

  /* ---------------- Scrollbars ---------------- */

  .CodeMirror-scroll {
    scrollbar-width: auto;
    scrollbar-color: #ffffff #000000;
  }

  .CodeMirror-scroll::-webkit-scrollbar {
    width: 14px;
  }

  .CodeMirror-scroll::-webkit-scrollbar-thumb {
    background: #ffffff !important;
    border: 3px solid #000000;
  }

  .CodeMirror-scroll::-webkit-scrollbar-track {
    background: #000000 !important;
  }

  /* ---------------- Font Rendering ---------------- */

  .CodeMirror,
  .editor-toolbar,
  .editor-preview {
    -webkit-font-smoothing: auto !important;
    -moz-osx-font-smoothing: auto !important;
  }
}

.theme-contrast {
    @include high-contrast-theme();
}

@media (prefers-contrast: more) {
	body {
		@include high-contrast-theme();
	}
}
