@use '../definitions' as *;
@use 'sass:color';

@mixin dark-theme {
	/* Primitives - Neutrals */
    --color-neutral-000: #1a1e23; /* Deep Slate Background */
    --color-neutral-050: #222931; /* Toolbar/Card Surface */
    --color-neutral-100: #2b333e; /* Main Surface (Matches image) */
    --color-neutral-200: #333c4a; /* Elevated Surface */
    --color-neutral-250: #3f4a5a; /* Borders / Dividers */
    --color-neutral-300: #4a5669; /* Muted Borders */
    --color-neutral-400: #64748b; /* Slate Gray Text */
    --color-neutral-500: #94a3b8; /* Muted Hint Text */
    --color-neutral-600: #cbd5e1; /* Secondary Text */
    --color-neutral-700: #e2e8f0; /* Body Text */
    --color-neutral-800: #f1f5f9; /* High Emphasis Text */
    --color-neutral-900: #ffffff;

    /* Primitives - Brand (Slate-Blue Accents) */
    --color-brand-400: #9cdcfe; /* Light "Glow" Blue from image */
    --color-brand-500: #38bdf8; /* Vibrant Sky Blue */
    --color-brand-600: #0ea5e9;

    --color-accent-500: #4fc3f7;

    /* Semantic - Adjusted to sit on Slate */
    --color-success-500: #b5cea8; /* Sage green from image */
    --color-danger-500: #f87171; /* Soft coral */
    --color-warning-500: #ce9178; /* Peach/Copper from image */
    --color-info-500: #7dd3fc;

    /* Track Changes (Cooler Tones) */
    --color-track-ins-bg: #1e3a3a; /* Deep Teal */
    --color-track-del-bg: #4a2b2b; /* Deep Rose */

  div.EasyMDEContainer {
    background: $bg-body;
    color: $text-main;

    .CodeMirror {
      background: $bg-surface;
      caret-color: $color-brand-400;
      color: $text-main;
    }

    .CodeMirror-focused {
      box-shadow:
        0 0 0 2px rgba(56, 189, 248, 0.35),
        0 10px 35px rgba(0, 0, 0, 0.45);
    }

    @keyframes caret-glow {
      0% { box-shadow: 0 0 2px rgba(56, 189, 248, 0.4); }
      50% { box-shadow: 0 0 8px rgba(56, 189, 248, 0.85); }
      100% { box-shadow: 0 0 2px rgba(56, 189, 248, 0.4); }
    }

    .CodeMirror-cursor {
      border-left-color: $color-brand-500;
      animation: caret-glow 1.6s ease-in-out infinite;
    }
    .CodeMirror-activeline-background {
      background:
        linear-gradient(
          90deg,
          rgba(56, 189, 248, 0.12),
          rgba(56, 189, 248, 0.04) 60%,
          rgba(56, 189, 248, 0.02)
        );
      box-shadow:
        inset 0 0 0 1px rgba(56, 189, 248, 0.08),
        inset 0 0 14px rgba(56, 189, 248, 0.14);
    }
    .CodeMirror-gutters {
      border-right-color: $color-neutral-250;
    }

    .CodeMirror-activeline-gutter .CodeMirror-linenumber {
      color: $color-brand-400;
      background:
        linear-gradient(
          90deg,
          rgba(56, 189, 248, 0.22),
          rgba(56, 189, 248, 0.06)
        );
      box-shadow:
        inset 0 0 0 1px rgba(56, 189, 248, 0.18),
        inset 0 0 10px rgba(56, 189, 248, 0.2);
    }
    .CodeMirror-selected {
      background:
        linear-gradient(
          90deg,
          rgba(56, 189, 248, 0.08),
          rgba(56, 189, 248, 0.22) 14%,
          rgba(56, 189, 248, 0.22) 86%,
          rgba(56, 189, 248, 0.08)
        );
      box-shadow:
        inset 0 0 0 1px rgba(56, 189, 248, 0.16),
        inset 0 0 18px rgba(56, 189, 248, 0.24);
    }
    .editor-preview,
    .editor-preview-side {
      background: $color-neutral-100;
      color: $color-neutral-800;

      ::selection {
        background: rgba(56, 189, 248, 0.28);
      }
    }
    .CodeMirror,
    .editor-toolbar,
    .editor-statusbar {
      -webkit-font-smoothing: antialiased;
      -moz-osx-font-smoothing: grayscale;
    }
    &.is-inactive {
      .CodeMirror-cursor {
        animation: none;
        opacity: 0.5;
      }
      .CodeMirror-activeline-background,
      .CodeMirror-selected {
        background: transparent;
        box-shadow: none;
      }
    }
  }
}

.theme-dark {
  @include dark-theme();
}

@media (prefers-color-scheme: dark) {
  .theme-auto {
    @include dark-theme();
  }
}