@use '../definitions' as *;
@use 'sass:color';

// Fix to make sure easymde sits in front of sidebar/header/bottom-bar
div.EasyMDEContainer {
	div.fullscreen.editor-toolbar {
		border-top: 2px solid $color-brand-500;
	}
	div.fullscreen.editor-toolbar, & div.CodeMirror-fullscreen, & div.editor-preview-side {
		z-index: 150;
	}
  .CodeMirror-lines {
    line-height: 1.6rem;
  }
  /* ---------------- Toolbar ---------------- */

  div.editor-toolbar, div.editor-toolbar.fullscreen {
    background: $bg-panel;
    border-bottom: 1px solid $border-color;
    border-radius: $radius-standard $radius-standard 0 0;

    button, a {
      color: $text-main;
      transition: background 0.15s ease, color 0.15s ease;

      &:hover, &.active {
        background: $sidebar-hover;
        color: $text-inverse;
      }
      &.active {
        background: $action-primary;
      }
    }
  }
}

.autosave-notification {
	align-items: flex-end;
	background: $flash-notice-bg;
	color: $flash-notice-text;
	display: flex;
	padding: 1em;

	button {
		float: right;
		margin: -0.7em 0 0 0;
	}
}

/* ======================================================
   EasyMDE â€“ Base + Light Theme
====================================================== */

.EasyMDEContainer {
  background: $bg-surface;
  color: $text-main;
  border: 1px solid $border-color;
  border-radius: $radius-standard;
  transition: opacity 0.2s ease, filter 0.2s ease;

  &.is-inactive {
    opacity: 0.65;
    filter: grayscale(0.15);
  }
}

/* ---------------- Editor ---------------- */

.CodeMirror {
  background: $bg-panel;
  color: $text-main;
  font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI",
    Roboto, Helvetica, Arial, sans-serif;
  font-size: 0.95rem;
  line-height: 1.6;
  border-radius: $radius-standard;
}

/* Focus glow */
.CodeMirror-focused {
  outline: none;
  box-shadow:
    0 0 0 2px $input-focus-ring,
    0 6px 20px rgba(0, 0, 0, 0.15);
  backdrop-filter: blur(2px);
}

/* ---------------- Status Bar ---------------- */

.editor-statusbar {
  color: $text-muted;
  border-top: 1px solid $border-color;
}

/* ======================================================
   Syntax Highlighting (Markdown)
====================================================== */

.cm-header {
  color: $action-primary;
  font-weight: 600;
}

.cm-strong {
  font-weight: 600;
}

.cm-em {
  font-style: italic;
}

.cm-link {
  color: $link-color;
}

.cm-url {
  color: $link-hover;
}

.cm-quote {
  color: $text-muted;
  border-left: 3px solid $border-color;
  padding-left: 0.75rem;
}

.cm-code,
.cm-inline-code {
  background: $color-neutral-200;
  color: $color-brand-700;
  padding: 0.1rem 0.25rem;
  border-radius: 4px;
}

.cm-comment {
  color: $text-muted;
  opacity: 0.85;
}

/* ======================================================
   Cursor + Active Line
====================================================== */

.CodeMirror-cursor {
  border-left: 2px solid $action-primary;
}

.CodeMirror-activeline-background {
  background: rgba(0, 102, 153, 0.06);
  transition: background 0.15s ease;
}

/* ---------------- Gutter ---------------- */

.CodeMirror-gutters {
  border-right: 1px solid $border-color;
  background: transparent;
}

.CodeMirror-linenumber {
  transition: color 0.15s ease, background 0.15s ease;
}

.CodeMirror-activeline-gutter .CodeMirror-linenumber {
  color: $action-primary;
  background: rgba(0, 102, 153, 0.06);
  border-radius: 4px;
}

/* ======================================================
   Selection (Feathered)
====================================================== */

.CodeMirror-selected {
  background:
    linear-gradient(
      90deg,
      rgba(0, 102, 153, 0.08),
      rgba(0, 102, 153, 0.18) 12%,
      rgba(0, 102, 153, 0.18) 88%,
      rgba(0, 102, 153, 0.08)
    );
  transition: background 0.15s ease;
}

/* ======================================================
   Scrollbars
====================================================== */

.CodeMirror-scroll {
  scrollbar-width: thin;
  scrollbar-color: $color-neutral-500 transparent;
}

.CodeMirror-scroll::-webkit-scrollbar {
  width: 10px;
}

.CodeMirror-scroll::-webkit-scrollbar-thumb {
  background-color: $color-neutral-400;
  border-radius: 10px;
  border: 2px solid transparent;
  background-clip: content-box;
}

/* ======================================================
   Preview
====================================================== */

.editor-preview,
.editor-preview-side {
  background: $bg-panel;
  color: $text-main;
  padding: 1.5rem 2rem;
  line-height: 1.7;

  ::selection {
    background: rgba(0, 102, 153, 0.22);
  }
}

/* ======================================================
   Font smoothing (Light)
====================================================== */

.theme-light {
  .EasyMDEContainer,
  .CodeMirror {
    -webkit-font-smoothing: subpixel-antialiased;
    -moz-osx-font-smoothing: auto;
  }
}
