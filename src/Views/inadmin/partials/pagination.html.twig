{% set totalPages = (total / limit)|round(0, 'ceil') %}
{% set lastPageOffset = (totalPages - 1) * limit %}
{% set currentPageIndex = (offset / limit)|round(0, 'floor') %}
{% set halfWindow = (maxPagesToShow / 2)|round(0, 'floor') %}
{% set startPageIndex = currentPageIndex - halfWindow %}
{% set endPageIndex = startPageIndex + maxPagesToShow - 1 %}
{% if startPageIndex < 0 %}
    {% set startPageIndex = 0 %}
    {% set endPageIndex = min(maxPagesToShow - 1, totalPages - 1) %}
{% elseif endPageIndex > totalPages - 1 %}
    {% set endPageIndex = totalPages - 1 %}
    {% set startPageIndex = max(0, totalPages - maxPagesToShow) %}
{% endif %}
{% set pagination_start = offset %}
{% set pagination_end = min(offset + limit - 1, total) %}

{% block pagination %}
<section class="pagination--row">

{% if showSummary is defined and showSummary %}
    <p class="pagination--info" aria-live="polite">
        Showing
        <strong>{{ pagination_start|number_format }}</strong>
        {%- if pagination_start != pagination_end -%}
            -<strong>{{ pagination_end|number_format }}</strong>
        {% endif %}
        of <strong>{{ total }}</strong> results
    </p>
{% endif %}

    <nav role="navigation" aria-label="Pagination Navigation">
        <ul class="pagination">
{% if showTitle|default(false) %}
            <li><span>{{ title|default('Pages:') }}</span></li>
{% endif %}

{% if startPageIndex > 0 %}
            <li class="page-item">
                <a href="{{ result_url ~ '/0/' ~ limit }}"
                   aria-label="Go to first page" class="page-link">1</a>
            </li>

    {% if startPageIndex > 1 %}
            <li class="pagination-spacer" aria-hidden="true"><span aria-hidden="true">…</span></li>
    {% endif %}
{% endif %}

{% if showFirstNext|default(false) %}
            <li class="page-item{% if currentPageIndex <= 0 %} disabled{% endif %}">
                <a href="{{ result_url ~ '/' ~ max(0, (currentPageIndex - 1) * limit) ~ '/' ~ limit }}"
                   rel="prev"
                   aria-label="Go to previous page"
                   class="page-link"
                   {% if currentPageIndex <= 0 %}aria-disabled="true" tabindex="-1"{% endif %}>
                    Previous
                </a>
            </li>
{% endif %}

{% for pageIndex in range(startPageIndex, endPageIndex) %}
    {% set pageNum = pageIndex + 1 %}
            <li class="page-item{% if pageIndex == currentPageIndex %} current{% endif %}">
                <a href="{{ result_url ~ '/' ~ (pageIndex * limit) ~ '/' ~ limit }}"
                   class="page-link"
                   aria-label="Go to page {{ pageNum }}"
                   {% if pageIndex == currentPageIndex %}aria-current="page"{% endif %}>
                    {{ pageNum }}
                </a>
            </li>
{% endfor %}

{% if showFirstNext|default(false) %}
            <li class="page-item{% if currentPageIndex >= totalPages - 1 %} disabled{% endif %}">
                <a href="{{ result_url ~ '/' ~ min(lastPageOffset, (currentPageIndex + 1) * limit) ~ '/' ~ limit }}"
                   rel="next"
                   aria-label="Go to next page"
                   class="page-link"
                   {% if currentPageIndex >= totalPages - 1 %}aria-disabled="true" tabindex="-1"{% endif %}>
                    Next
                </a>
            </li>
{% endif %}

{% if endPageIndex < totalPages - 1 %}
    {% if endPageIndex < totalPages - 2 %}
            <li class="pagination-spacer" aria-hidden="true"><span aria-hidden="true">…</span></li>
    {% endif %}
            <li class="page-item">
                <a href="{{ result_url ~ '/' ~ lastPageOffset ~ '/' ~ limit }}"
                   aria-label="Go to last page"
                   class="page-link">
                    {{ totalPages }}
                </a>
            </li>
{% endif %}
        </ul>
    </nav>
</section>
{% endblock pagination %}
